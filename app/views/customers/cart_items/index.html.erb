<h1>ショッピングカート</h1>
<table>
  <tr>
    <th>商品名</th>
    <th>単価（税込）</th>
    <th>数量</th>
    <th>小計</th>
    <th></th>
  </tr>
  <% sum = 0 %>
  <% @cart_items.each do |cart_item| %>
    <% item = cart_item.item %>
    <tr>
      <td><%= attachment_image_tag item, :image, :fill, 30, 30, format: 'jpeg', fallback: "no_image.jpg" %><%= item.name %></td>
      <td><%= number_to_currency item.price * 1.08, precision: 0, unit: "", format: "%u %n" %></td>
      <td>
        <%= form_with model: cart_item, local:true do |f| %>
          <%= f.number_field :amount %>
          <%= f.submit "更新" %>
        <% end %>
      </td>
      <td><%= number_to_currency cart_item.subtotal_price, precision: 0, unit: "", format: "%u %n" %></td>
      <td><%= link_to "削除する", cart_item_path(cart_item.id), method: :delete %></td>
    </tr>
    <% sum += cart_item.subtotal_price %>
  <% end %>
</table>
<%= link_to "買い物を続ける", items_path %>
<table>
  <tr>
    <th>合計金額</th>
    <td><%= number_to_currency sum * 1.08, precision: 0, unit: "", format: "%u %n" %></td>
  </tr>
</table>

